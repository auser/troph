#!/usr/bin/env ruby
$:.unshift(File.dirname(__FILE__) + "/../lib")
require "troph"
require 'git-style-binary/command'

GitStyleBinary.command do  
  version "Troph Server"
  banner <<-EOS
Usage: #{$0} #{all_options_string} COMMAND [ARGS]

  Start a troph serve

See 'troph help COMMAND' for more information on a specific command.
EOS
    
  opt :host, "Host ip of the server to broadcast", :default => "127.0.0.1"
  opt :file, "Server config file", :type => String, :default => "../API"
  
  run do |command|
    puts "Starting a server at #{command[:host]}"
    server = if file = ::File.expand_path(command[:file])
      raise StandardError.new("Cannot find file: #{file}") unless ::File.file?(file)
      data = open(file).read
      eval data
    end
    
    server.run
    
  end
end