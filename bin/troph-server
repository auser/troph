#!/usr/bin/env ruby
$:.unshift(File.dirname(__FILE__) + "/../lib")
require "troph"
require 'git-style-binary/command'

GitStyleBinary.command do  
  version "Troph Server"
  banner <<-EOS
Usage: #{$0} #{all_options_string} COMMAND [ARGS]

  Start a troph serve

See 'troph help COMMAND' for more information on a specific command.
EOS
    
  opt :host, "Host ip of the server to broadcast", :default => "127.0.0.1"
  
  run do |command|
    puts "Starting a server at #{command[:host]}"
    
    Troph::Server.new "troph" do
      
      add_message_handler Troph::PresenceHandler
      
      add_runtime_caller Troph::PeriodicChecker, 10
      
      announce_presence command[:host]
      
    end.run
    
  end
end